import{f as u}from"./fetch-DBomrZ5j.js";const m=async s=>{s.preventDefault();const e=document.querySelector(".registerForm"),o=e.querySelector("#username").value.trim(),c=e.querySelector("#password").value.trim(),a=e.querySelector("#email").value.trim(),r={username:o,password:c,email:a};try{const n=await fetch("http://localhost:3000/api/users",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(r)}),t=await n.json();if(!n.ok)throw new Error(t.error||"Rekisteröinti epäonnistui");console.log(t.message,"success"),e.reset();const i=await fetch("http://localhost:3000/api/auth/login",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({username:o,password:c})}),l=await i.json();if(!i.ok)throw new Error("Kirjautuminen epäonnistui rekisteröinnin jälkeen");localStorage.setItem("token",l.token),localStorage.setItem("nimi",l.user.username)}catch(n){console.error(n.message)}},g=async s=>{s.preventDefault();const e=document.querySelector(".loginForm"),o=e.querySelector("#username").value.trim(),c=e.querySelector("#password").value.trim(),a={username:o,password:c},r="http://localhost:3000/api/auth/login",n={body:JSON.stringify(a),method:"POST",headers:{"Content-type":"application/json"}};console.log(n);const t=await u(r,n);if(t.error){console.error("Error adding a new user:",t.error);return}t.message&&(console.log(t.message,"success"),localStorage.setItem("token",t.token),localStorage.setItem("nimi",t.user.username)),console.log(t),e.reset()},d=async s=>{s.preventDefault();const e="http://localhost:3000/api/auth/me";let o={};o={Authorization:`Bearer ${localStorage.getItem("token")}`};const a={headers:o};console.log(a);const r=await u(e,a);if(r.error){console.error("Error getting personal data:",r.error);return}r.message&&console.log(r.message,"success"),console.log(r)};document.addEventListener("DOMContentLoaded",()=>{const s=document.querySelector(".registerForm"),e=document.querySelector(".loginForm"),o=document.querySelector("#meRequest");s&&s.addEventListener("submit",m),e&&e.addEventListener("submit",g),o&&o.addEventListener("click",d)});
